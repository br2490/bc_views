<?php

/**
 * Implements hook_block_info().
 */
function bc_views_block_info() {
 	$blocks['bc_solrYearbook'] = array( 
 		'info' => t('SOLR Collection for the Annual and Mortarboard (yearbook).'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'yearbook2',
		'region' => 'content'
 	);
	$blocks['bc_solrNewspaper'] = array( 
		'info' => t('SOLR Collection for the Barnard Bulletin (newspaper).'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'newspaper2',
		'region' => 'content'
	);
	$blocks['bc_solrStudentPubs'] = array( 
		'info' => t('SOLR Collection for Student Publications.'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'studentpubs2',
		'region' => 'content'
	);
	$blocks['bc_solrPhotos'] = array( 
		'info' => t('SOLR Collection for Photos.'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'photos2',
		'region' => 'content'
	);
 	return $blocks;
}

/**
 * Implements hook_block_save().
 */
function bc_views_block_save($delta = '', $edit = array()) {
  $prefix = 'bc_solr';
  if (stripos($delta, $prefix) !== FALSE) {
    dsm($delta);
    dsm($edit);
    dsm($edit[pages]);
  }
}

/**
 * Implements hook_block_view().
 */
function bc_views_block_view($delta = '') {
	$block = array();
	dsm($delta);
	switch ($delta) {

		// Yearbook View
		case 'bc_solrYearbook' :
			if (!$_GET['display']) {
    			$_GET['display'] = 'grid';
			}
			$query = 'mods_relatedItem_host_titleInfo_title_ms%3A"Mortarboard" AND RELS_EXT_isMemberOf_uri_ms%3A"info:fedora/islandora:bookCollection"';
			$content = islandora_solr($query, NULL);
			$block['content'] = $content;
		break;

		// Barnard Bulletin View
		case 'bc_solrNewspaper';
			$query = '';
			$block['content'] = 'Pseudo Exception: Barnard Bulletin: Not Implemented.';
		break;

		// Student Publications View
		case 'bc_solrStudentPubs';
			if (!$_GET['display']) {
    			$_GET['display'] = 'grid';
			}
			$query = 'RELS_EXT_isMemberOf_uri_ms%3A"info:fedora/bc:barnard-literary-magazine"';
			$content = islandora_solr($query, NULL);
			$block['content'] = $content;
		break;

		// Photographs View
		case 'bc_solrPhotos';
			//mods_genre_ms:photographs
			$query = '';
			$block['content'] = 'Pseudo Exception: Photographs: Not Implemented.';
		break;
	}
	return $block;
}

/**
 * Implements hook_islandora_solr_query().
 */
function bc_views_islandora_solr_query($islandora_solr_query) {
	dsm("hook query fires");
}

/**
 * Implements hook_islandora_solr_query_alter().
 * I use this hook to respect the 'default landing page display count' setting (soon to come).
 */
function bc_views_islandora_solr_query_alter(&$islandora_solr_query) {
	dsm("hook query alter fires");
	$islandora_solr_query->solrLimit = '8';
}

// AFTER THIS THE QUERY IS PROCESSED BY ISLANDORA_SOLR();

/**
 * Implements hook_islandora_solr_query_result().
 */
function bc_views_islandora_solr_query_result($result) {
	dsm("hook query result fires");
	dsm($result);
}

/**
 * Implements hook_islandora_solr_results_alter().
 */
function bc_views_islandora_solr_results_alter(&$search_results, $query_processor) {
	dsm("hook query result alter fires");
	dsm($search_results);
	dsm($query_processor);
}
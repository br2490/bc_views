<?php

/**
 * Implements hook_block_info().
 */
function bc_views_block_info() {
 	$blocks['bc_solrYearbook'] = array( 
 		'info' => t('SOLR Collection for the Annual and Mortarboard (yearbook).'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'yearbook2',
		'region' => 'content'
 	);
	$blocks['bc_solrNewspaper'] = array( 
		'info' => t('SOLR Collection for the Barnard Bulletin (newspaper).'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'newspaper2',
		'region' => 'content'
	);
	$blocks['bc_solrStudentPubs'] = array( 
		'info' => t('SOLR Collection for Student Publications.'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'studentpubs2',
		'region' => 'content'
	);
	$blocks['bc_solrPhotos'] = array( 
		'info' => t('SOLR Collection for Photos.'),
		'status' => BLOCK_VISIBILITY_LISTED,
		'pages' => 'photos2',
		'region' => 'content'
	);
 	return $blocks;
}

/**
 * Implements hook_block_save().
 */
function bc_views_block_save($delta = '', $edit = array()) {
  $prefix = 'bc_solr';
  if (stripos($delta, $prefix)) {
    dsm($delta);
    dsm($edit);
    dsm($edit[pages]);
  }
}

/**
 * Implements hook_block_view().
 */
function bc_views_block_view($delta = '') {
	$block = array();
	dsm($delta);
	switch ($delta) {

		// Yearbook View
		case 'bc_solrYearbook' :
			if (!$_GET['display']) {
    			dsm('updated $_GET');
    			$_GET['display'] = 'grid';
			}
			$query = 'mods_relatedItem_host_titleInfo_title_ms%3A"Mortarboard" AND RELS_EXT_isMemberOf_uri_ms%3A"info:fedora/islandora:bookCollection"';
			$content = islandora_solr($query, NULL);
			$block['content'] = $content;
		break;

		// Barnard Bulletin View
		case 'bc_solrNewspaper';
			$query = '';
			$block['content'] = 'Pseudo Exception: Barnard Bulletin: Not Implemented.';
		break;

		// Student Publications View
		case 'bc_solrStudentPubs';
			if (!$_GET['display']) {
    			dsm('updated $_GET');
    			$_GET['display'] = 'grid';
			}
			$query = 'RELS_EXT_isMemberOf_uri_ms%3A"info:fedora/bc:barnard-literary-magazine"';
			$content = islandora_solr($query, NULL);
			$block['content'] = $content;
		break;

		// Photographs View
		case 'bc_solrPhotos';
			//mods_genre_ms:photographs
			$query = '';
			$block['content'] = 'Pseudo Exception: Photographs: Not Implemented.';
		break;
	}
	return $block;
}

/* 
 * either useful or already deprecated. time will tell.
 * function solrQuery()
 * arg1 = SOLR Query
 * 
*/
function solrQuery($q) { 
  $qp = new IslandoraSolrQueryProcessor();
  $query = $q;
  $qp->buildQuery($query);
  $qp->executeQuery();

  $numFound = $qp->islandoraSolrResult['response']['numFound'];
  $objects = $qp->islandoraSolrResult['response']['objects'];

  dsm($numFound);
  
  // LOGIC HERE (foreach) if ($numFound > 1) { do this } else { do the shit below } 
  // IS THIS NESS?
  $pid = $objects[0]['PID'];
  $fedora_object = islandora_object_load($pid);
  $islandora_view = islandora_view_object($fedora_object);

  return $islandora_view;
}